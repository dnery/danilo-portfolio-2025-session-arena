<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Session Arena</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
</head>
<body>
  <main>
    <h1>Session Arena</h1>
    <label class="toggle">
      <input id="flag" type="checkbox" {{ 'checked' if cool_mode else '' }} />
      <span>Critically Cool Mode</span>
    </label>

    <div class="stage">
      <div id="orb" class="orb"></div>
    </div>
  </main>

  <script>
    const orb = document.getElementById('orb');
    const checkbox = document.getElementById('flag');

    // initial interaction
    function vibrate(on) {
      if (on) {
        gsap.to('#orb', { scale: 1.25, yoyo: true, repeat: -1, duration: 0.8 });
        gsap.to('#orb', { boxShadow: "0 0 32px rgba(0,255,200,0.8)", duration: 0.8 });
      } else {
        gsap.killTweensOf('#orb');
        gsap.to('#orb', { scale: 1, boxShadow: "0 0 8px rgba(0,0,0,0.3)", duration: 0.4 });
      }
    }
    vibrate(checkbox.checked);

    checkbox.addEventListener('change', async () => {
      try {
        const res = await fetch('/api/flags/cool_mode/toggle', { method: 'POST' });
        const data = await res.json();
        vibrate(data.enabled);
      } catch (e) { console.error(e); }
    });
  </script>
</body>
</html>

